---
title: "Outbreak reconstruction using *outbreaker2*"
author: "Thibaut Jombart, Finlay Campbell"
date: "2017-12-12"
output:
  ioslides_presentation:
    incremental: false
---



```{r setup, include=FALSE}
## This code defines the 'verbatim' option for chunks
## which will include the chunk with its header and the
## trailing "```".

require(knitr)
hook_source_def = knit_hooks$get('source')
knit_hooks$set(source = function(x, options){
  if (!is.null(options$verbatim) && options$verbatim){
    opts = gsub(",\\s*verbatim\\s*=\\s*TRUE\\s*.*$", "", options$params.src)
    bef = sprintf('\n\n    ```{r %s}\n', opts, "\n")
    stringr::str_c(bef, paste(knitr:::indent_block(x, "    "), collapse = '\n'), "\n    ```\n")
  } else {
     hook_source_def(x, options)
  }
})
```






# Inferring who infected whom

## General idea

Original *outbreaker* model used serial interval and genetic data to reconstruct
transmission events.

<center> 
<img src="../../img/slides/outbreaker-original-model.png" width="70%">
</center> 
<br>




## *outbreaker2*: a modular platform for outbreak reconstruction

<center>
<img src="../../img/slides/outbreaker2-pot.jpg" width="90%">
</center>
<br>







# From data to probabilities


## Temporal likelihood

**Relies on:** dates on <font color="#99004d">symptom onset</font> ($t_i$),
<font color="#99004d">generation time</font> ($w()$), <font
color="#99004d">incubation period</font> ($f()$), number of generations
($\kappa_i$).

<center>
<img src="../../img/slides/serial-interval.jpg" width="50%">
</center>

$$
p(t_i | T_i^{inf}) \times p(T_i^{inf} | T_{\alpha_i}^{inf}, \kappa_i)
$$

$$
 = f(t_i - T_i^{inf}) \times w^{(\kappa_i)}(T_i^{inf} - T_{\alpha_i}^{inf})
$$




## Reporting likelihood

**Relies on:** 

- $\kappa_i$: <font color="#99004d">number of generations</font> between case
  $i$ and its more recent sampled "ancestor"

- $\pi$ case <font color="#99004d">reporting</font> probability

<br>

**Geometric distribution:**

$$
p(\kappa_i | \pi) = (1 - \pi^{})^{\kappa_i - 1} \times \pi 
$$




## Genetic likelihood

**Relies on:** 

- $d()$: number of <font color="#99004d">mutations</font> between 2 sequences
- $s_i$, $s_{\alpha_i}$: sequences of infectee their infector
- $L$: genome length
- $\mu$: <font color="#99004d">mutation rate</font> per generation of infection


$$
p(s_i | s_{\alpha_i} \mu) = \mu^{d(s_i, s_{\alpha_i})} \times 
(1 - \mu)^{(\kappa_i L - d(s_i, s_{\alpha_i}))}
$$



## Contact likelihood

**Relies on:** contact reporting probability ($\epsilon$) and probability of
contact between non-transmission pairs ($\lambda$).

<center>
<img src="../../img/slides/contact-model.png" width="100%">
</center>

$\alpha_i = j$:  $p(c_{i,j} = 1 ) = \epsilon$ ; $p(c_{i,j} = 0) = 1 - \epsilon$

$\alpha_i \neq j$: $p(c_{i,j} = 1) = \lambda \epsilon$ ; $p(c_{i,j} = 0) = (1 - \lambda) + \lambda (1 - \epsilon)$
